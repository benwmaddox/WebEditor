<html><head></head><body></body><script>
var Context = {
  "HTML": {
    "tag": (tagName, attributes, children) => '<' + tagName + '>' + children.join('') + '</' + tagName + '>'
  },
  "Core": {
    "help": function () {
      // TODO: return some notes. possibly interactive with state being saved to help
    },
    "stringify": function stringify(obj) {
      //https://gist.github.com/cowboy/3749767
      var placeholder = '____PLACEHOLDER____';
      var fns = [];
      var json = JSON.stringify(obj, function (key, value) {
        if (typeof value === 'function') {
          fns.push(value);
          return placeholder;
        }
        return value;
      }, 2);
      json = json.replace(new RegExp('"' + placeholder + '"', 'g'), function (_) {
        return fns.shift();
      });
      return json;
    },
    "save": async function save() {
      this.handler = this.handler || await window.showSaveFilePicker();
      var contentBlob = Context.Core.stringify(Context);
      var tag = Context.HTML.tag;
      var htmlPage = tag('html', [],
        [tag('head', [], [
          
        ]
        ),
        tag('body', [], []),
		tag('script', [], ['\nvar Context = ' + contentBlob + '\nContext.main();\n'])
        ]
      );
      const writableStream = await this.handler.createWritable();
      await writableStream.write(htmlPage);
      await writableStream.close();
    },
    "view": function view(fn) {
      // console.log(fn.toString());
      return fn.toString();
    },
    "edit": function edit(fn) {
      copy(fn.toString());
      console.log(`Item copied to the clipboard`);
      // debugger;
    },
    "renderTemplate": function render(templateSelector, targetSelector, model) {

    }
  },
  "main": function main() {
    // Add some favorite functions to the top level
    window.edit = Context.Core.edit;
    window.view = Context.Core.view;
    window.save = Context.Core.save;
	
	// init the app
    Context.Pages.Home.render(null, null);
  },
  "Pages": {
    "Home": {
      "render": function(targetSelector, model) {
    var html = `
<H1>Welcome</H1>
<p>Please open dev tools, Console, then start interacting with the Context object for development</p>

<p>If you want to change a function, you could run something like: Context.main = function(){ [...]}. You define everything in the browser. Then run save() in the console and pick the same html file you started editing. It will overwrite the existing file and include all of the changes you put into the Context object. This is meant to be edited in a single file and allow very interactive development.</p>

<p>Once you save the file once without reloading, it should be faster to save again just by calling save(). I recommend using source control frequently after saving to disk. You should rarely need to reload the page while developing</p>

<p>This tool doesn't care which rendering engine you use.</p>

<p>When developing, please try to use the full path to functions like Context.Core.stringify(). That allows you to change the function and everything that calls it will work correctly.</p>

<p>To edit a function, such as Core.main, call edit(Core.main) which copies the function content to your clipboard. Paste into the console. Then add this before the function definition: 'Core.main = '. I'll try to make it easier in the future, but it does work like this.</p>`;
    document.querySelector(targetSelector || 'body').innerHTML = html;
}
    },
    "Demo": {
      "render": function(targetSelector){
    window.Data = window.Data || {};
    var Data  = window.Data;
    Data.Pages = Data.Pages || {};
    Data.Pages.Demo = Data.Pages.Demo || {};
    Data.Pages.Demo.model = Data.Pages.Demo.model || { count: 0 } 
    var model = Data.Pages.Demo.model;
    
    var html = `
Counter demo:
Current count: ${model.count}
<button id="increment" onclick="Context.Pages.Demo.increment()">Increment</button><button id="decrement" onclick="Context.Pages.Demo.decrement()">Decrement</button>
`;
    document.querySelector(targetSelector || 'body').innerHTML = html;
},
      "increment": function(){
    
    window.Data = window.Data || {};
    var Data = window.Data;
    Data.Pages = Data.Pages || {};
    Data.Pages.Demo = Data.Pages.Demo || {};
    Data.Pages.Demo.model = Data.Pages.Demo.model || { count: 0 } 
    Data.Pages.Demo.model.count++;
    Context.Pages.Demo.render();
},
      "decrement": function(){
    window.Data = window.Data || {};
    var Data = window.Data;
    Data.Pages = Data.Pages || {};
    Data.Pages.Demo = Data.Pages.Demo || {};
    Data.Pages.Demo.model = Data.Pages.Demo.model || { count: 0 } 
    Data.Pages.Demo.model.count--;
    Context.Pages.Demo.render();

}
    }
  }
}
Context.main();
</script></html>